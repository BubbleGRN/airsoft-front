import{b as Z,al as z,u as G,a as H,ak as J,r as P,o as K,e as Y,f as e,g as t,aM as V,ap as s,an as y,ao as p,Z as ee,h as r,aV as k,aU as S,bR as ae,aN as te,aP as le,aQ as re,aW as ue,aX as oe,F as ne,ar as se}from"./index-UR6t7LWQ.js";import{c as F,b as de,u as N,d as C,a as Q,f as B,V as q}from"./index.esm-CeVDuEnI.js";import{b as T}from"./route-block-B_A1xBdJ.js";import{V as D,a as d}from"./VRow-C0F7vqWP.js";import{V as ie}from"./VDivider-z7DtT3J7.js";import{V as me}from"./VContainer-CTkW8SnP.js";import"./_commonjsHelpers-Cpj98o6Y.js";const ce={class:"text-center"},pe={__name:"[id]",setup(ve){const{api:x,apiAuth:h}=se(),A=Z(),R=z(),{t:o}=G(),i=H(),$=J(),n=P({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:"gun"});(async()=>{try{const{data:a}=await x.get("/product/"+A.params.id);n.value=a.result,document.title=n.value.name+" | 購物網站"}catch(a){console.log(a),R.push("/")}})();const j=F({quantity:de().typeError(o("product.addCartQuantityInvalid")).required(o("product.addCartQuantityInvalid")).positive(o("product.addCartQuantityInvalid")).integer(o("product.addCartQuantityInvalid"))}),{handleSubmit:L,isSubmitting:M}=N({validationSchema:j,initialValues:{quantity:1}}),I=C("quantity"),U=L(async a=>{var l,u;if(!i.isLoggedIn){R.push("/login");return}try{const{data:c}=await h.patch("/user/cart",{product:n.value._id,quantity:a.quantity});i.cart=c.result,$({text:o("product.addCartSuccess"),snackbarProps:{color:"green"}})}catch(c){console.log(c),$({text:o("api."+(((u=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:u.message)||"unknownError")),snackbarProps:{color:"red"}})}}),O=F({name:Q().required(o("product.nameRequired")),rentdate:B().required(o("product.rentDateRequired")).typeError(o("product.rentDateInvalid")),returndate:B().required(o("product.returnDateRequired")).typeError(o("product.returnDateInvalid")),location:Q().required(o("product.locationRequired"))}),{handleSubmit:W,isSubmitting:w}=N({validationSchema:O,initialValues:{name:"",rentdate:"",returndate:"",location:""}}),v=C("name"),g=C("rentdate"),b=C("returndate"),f=C("location"),_=W(async()=>{var a,l;if(!i.isLoggedIn){R.push("/login");return}try{const{data:u}=await h.patch("/user/rent",{product:n.value._id,name:v.value.value,rentdate:g.value.value,returndate:b.value.value,location:f.value.value});i.rent=u.result,console.log(typeof i.rent,i.rent),$({text:o("product.addRentSuccess"),snackbarProps:{color:"green"}}),E()}catch(u){$({text:o("api."+(((l=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:l.message)||"unknownError")),snackbarProps:{color:"red"}})}}),m=P({open:!1,id:""}),X=a=>{a&&(m.value.id=a._id,v.value.value=a.name,g.value.value="",b.value.value="",f.value.value=""),m.value.open=!0},E=()=>{m.value.id="",m.value.open=!1};return(a,l)=>(K(),Y(ne,null,[e(me,null,{default:t(()=>[e(D,null,{default:t(()=>[e(d,{cols:"11",class:"d-flex justify-center",style:{"padding-left":"130px"}},{default:t(()=>[V("h1",null,s(n.value.name),1)]),_:1}),e(d,{cols:"1",class:"text-right"},{default:t(()=>[e(y,{"prepend-icon":"mdi-keyboard-backspace",onClick:l[0]||(l[0]=u=>a.$router.go(-1))},{default:t(()=>l[8]||(l[8]=[p("返回上一頁")])),_:1})]),_:1}),e(ie),e(d,{cols:"12",md:"6"},{default:t(()=>[e(ee,{src:n.value.image},null,8,["src"])]),_:1}),e(d,{cols:"12",md:"6"},{default:t(()=>[V("p",null,s(a.$t("productCategory."+n.value.category)),1),V("p",null,s(n.value.price),1),V("p",null,s(n.value.description),1),e(D,{align:"center"},{default:t(()=>[e(d,{cols:"auto",class:"pt-8"},{default:t(()=>[e(q,{disabled:r(M),onSubmit:k(r(U),["prevent"])},{default:t(()=>[e(S,{modelValue:r(I).value.value,"onUpdate:modelValue":l[1]||(l[1]=u=>r(I).value.value=u),modelModifiers:{number:!0},type:"number","error-messages":r(I).errorMessage.value,label:"數量"},null,8,["modelValue","error-messages"])]),_:1},8,["disabled","onSubmit"])]),_:1}),e(d,{cols:"auto"},{default:t(()=>[e(q,{disabled:r(M),onSubmit:k(r(U),["prevent"])},{default:t(()=>[e(y,{type:"submit","prepend-icon":"mdi-cart",loading:a.isSubmitting},{default:t(()=>[p(s(a.$t("product.addCart")),1)]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1}),e(D,{align:"center"},{default:t(()=>[e(d,{cols:"auto"},{default:t(()=>[e(q,{disabled:a.isRentSubmitting,onSubmit:k(r(_),["prevent"])},{default:t(()=>[e(y,{type:"submit","prepend-icon":"mdi-send",loading:r(w),onClick:l[2]||(l[2]=u=>X(n.value))},{default:t(()=>[p(s(a.$t("product.addRent")),1)]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,{"model-value":!n.value.sell,class:"align-center justify-center",scrim:"black",opacity:"0.8",persistent:""},{default:t(()=>[V("h1",ce,s(a.$t("api.productNotOnSell")),1)]),_:1},8,["model-value"]),e(oe,{modelValue:m.value.open,"onUpdate:modelValue":l[7]||(l[7]=u=>m.value.open=u),persistent:"","max-width":"600px"},{default:t(()=>[e(q,{disabled:r(w),onSubmit:k(r(_),["prevent"])},{default:t(()=>[e(te,null,{default:t(()=>[e(le,null,{default:t(()=>[p(s(a.$t("product.rent")),1)]),_:1}),e(re,null,{default:t(()=>[e(S,{modelValue:r(v).value.value,"onUpdate:modelValue":l[3]||(l[3]=u=>r(v).value.value=u),label:a.$t("product.name"),"error-messages":r(v).errorMessage.value},null,8,["modelValue","label","error-messages"]),e(S,{modelValue:r(g).value.value,"onUpdate:modelValue":l[4]||(l[4]=u=>r(g).value.value=u),label:a.$t("event.rentdate"),"error-messages":r(g).errorMessage.value,type:"date"},null,8,["modelValue","label","error-messages"]),e(S,{modelValue:r(b).value.value,"onUpdate:modelValue":l[5]||(l[5]=u=>r(b).value.value=u),label:a.$t("event.returndate"),"error-messages":r(b).errorMessage.value,type:"date"},null,8,["modelValue","label","error-messages"]),e(S,{modelValue:r(f).value.value,"onUpdate:modelValue":l[6]||(l[6]=u=>r(f).value.value=u),label:a.$t("event.location"),"error-messages":r(f).errorMessage.value},null,8,["modelValue","label","error-messages"])]),_:1}),e(ue,null,{default:t(()=>[e(y,{onClick:E},{default:t(()=>[p(s(a.$t("adminEvent.cancel")),1)]),_:1}),e(y,{type:"submit",loading:r(w)},{default:t(()=>[p(s(a.$t("product.rentSubmit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};typeof T=="function"&&T(pe);export{pe as default};
